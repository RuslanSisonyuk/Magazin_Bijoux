@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
@model IEnumerable<Magazin_Bijoux.Models.CartItem>

@{
    ViewData["Title"] = "Home Page";
    string productList = "";
    float totalPrice = 0;
}
<head>
    <link rel="stylesheet" href="~/css/home.css" />
</head>
<style>
    a, p, h3 {
        color: black;
    }

    .small_cart_img {
        width: 140px;
        height: 160px;
        border: 1px solid rgba(0,0,0,0.8);
        box-shadow: 0px 3px rgba(0,0,0,0.1);
    }
</style>
<h3>My Cart</h3>
<div>
    @foreach (var item in Model)
    {
        totalPrice += item.getTotalPrice();
        productList += item.quantity+" "+item.product.name+": $"+item.getTotalPrice()+"<br>";
        <hr />
        <div style="display:flex; justify-content:space-between;">
            <div style="display:flex; flex-direction:row;">
                <img class="small_cart_img" src="~/Product_img216x288/@Html.DisplayFor(modelItem => item.product.imageURL)" />
                <div style="margin-left: 7px; margin-top: 20px;">
                    <p>@Html.DisplayFor(modelItem => item.product.name)</p>
                    <p>@Html.DisplayFor(modelItem => item.product.price)</p>
                </div>
            </div>
            <div>
                <div style="display:flex; flex-direction:row;">
                    <form asp-controller="CartItems" asp-action="RemoveFromCartAndReturn" asp-route-id="@item.productId">
                        <input type="hidden" name="action" value="Cart" />
                        <input type="hidden" name="controller" value="CartItems" />
                        <input type="hidden" name="hasParameter" value="false" />
                        <div class="form-group">
                            <input type="submit" value="-" />
                        </div>
                    </form>
                    <p>@Html.DisplayFor(modelItem => item.quantity)</p>
                    <form asp-controller="CartItems" asp-action="AddToCartAndReturn" asp-route-id="@item.productId">
                        <input type="hidden" name="action" value="Cart" />
                        <input type="hidden" name="controller" value="CartItems" />
                        <input type="hidden" name="hasParameter" value="false" />
                        <div class="form-group">
                            <input type="submit" value="+" />
                        </div>
                    </form>
                    <p>@item.getTotalPrice()</p>
                </div>
            </div>

            <form asp-controller="CartItems" asp-action="DeleteFromCart" asp-route-id="@item.itemId">
                <input type="hidden" name="action" value="Cart" />
                <input type="hidden" name="controller" value="CartItems" />
                <input type="hidden" name="hasParameter" value="false" />
                <div class="form-group">
                    <input type="submit" value="X" />
                </div>
            </form>
        </div>
    }
    <hr />
    <p>Total: @totalPrice</p>

    <form asp-controller="Mail" asp-action="SendPurchaseMail">
        <input type="hidden" name="UserName" value="@UserManager.GetUserAsync(User).Result.UserName" />
        <input type="hidden" name="ToEmail" value="@UserManager.GetUserAsync(User).Result.Email" />
        <input type="hidden" name="ItemList" value="@productList" />
        <input type="hidden" name="TotalPrice" value="@totalPrice" />
        <div class="form-group">
            <input type="submit" value="Finish purchase" class="card__button btn-primary" />
        </div>
    </form>
</div>